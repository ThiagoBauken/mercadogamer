<div class="container-fluid p-0">
  <div class="row justify-content-center pr-4 pb-4">
    <div class="col">
      <div class="row">
        <div class="col-md-6">
          <span class="title quest ml-4">Códigos de descuentos</span>
        </div>
        <div class="col-md-3"></div>
        <div class="col-md-3 text-right">
          <button
            class="btn btn-primary btn-block btn-save"
            (click)="openModal(code)"
          >
            Agregar Código
          </button>
        </div>
      </div>

      <div class="table-responsive mt-4">
        <table class="table">
          <thead>
            <tr>
              <th class="text-center">
                <button type="button" class="btn btn-clear">
                  <span class="text-light">Código</span>
                  <i class="fa" aria-hidden="true"></i>
                </button>
              </th>
              <th class="text-center">
                <button type="button" class="btn btn-clear">
                  <span class="text-light">Total</span>
                  <i class="fa" aria-hidden="true"></i>
                </button>
              </th>
              <th class="text-center">
                <button type="button" class="btn btn-clear">
                  <span class="text-light">Usados</span>
                  <i class="fa" aria-hidden="true"></i>
                </button>
              </th>
              <th class="text-center">
                <button type="button" class="btn btn-clear">
                  <span class="text-light">Restantes</span>
                  <i class="fa" aria-hidden="true"></i>
                </button>
              </th>
              <th class="text-center">
                <button type="button" class="btn btn-clear">
                  <span class="text-light">Tipo</span>
                  <i class="fa" aria-hidden="true"></i>
                </button>
              </th>
              <th class="text-center">
                <button type="button" class="btn btn-clear">
                  <span class="text-light">Valor</span>
                  <!-- <i class="fa"
                    aria-hidden="true"></i> -->
                </button>
              </th>
              <th class="text-center">
                <button type="button" class="btn btn-clear">
                  <span class="text-light">Activar</span>
                  <i class="fa" aria-hidden="true"></i>
                </button>
              </th>
              <th></th>
            </tr>
          </thead>

          <tbody>
            <!-- Cargador -->
            <tr *ngIf="loading" class="text-center">
              <td colspan="6">
                <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
                Cargando...
              </td>
            </tr>
            <!-- Texto cuando no hay resultados  -->
            <tr
              *ngIf="!loading && discountCodes?.length == 0"
              class="text-center"
            >
              <td colspan="6">
                <span class="text-muted">
                  <i class="fa fa-close" aria-hidden="true"></i>
                  No hay códigos de descuento para mostrar
                </span>
              </td>
            </tr>

            <tr *ngFor="let discountCode of discountCodes">
              <td class="text-center">
                {{ discountCode.code }}
              </td>
              <td class="text-center">
                <ng-container *ngIf="discountCode.infinite">
                  <img src="assets/imgs/infinite.svg" />
                </ng-container>
                <ng-container *ngIf="!discountCode.infinite">
                  {{ discountCode.total }}
                </ng-container>
              </td>
              <td class="text-center text-danger">
                {{ discountCode.spent }}
              </td>
              <td class="text-center text-success">
                <ng-container *ngIf="discountCode.infinite">
                  <img src="assets/imgs/infinite.svg" />
                </ng-container>
                <ng-container *ngIf="!discountCode.infinite">
                  {{ discountCode.available }}
                </ng-container>
              </td>
              <td class="text-center text-warning">
                {{ settings.discountCodes.type[discountCode.type].label }}
              </td>
              <td class="text-center">
                <ng-container
                  *ngIf="
                    discountCode.type ===
                    settings.discountCodes.type.percentage.code
                  "
                  >{{ discountCode.value }}%</ng-container
                >
                <ng-container
                  *ngIf="
                    discountCode.type === settings.discountCodes.type.cash.code
                  "
                  >{{
                    discountCode.value
                      | currency
                        : discountCode.country.currency
                        : 'code'
                        : '1.0-2'
                        : 'es-US'
                  }}</ng-container
                >
              </td>
              <td class="text-center">
                <mat-slide-toggle
                  color="mat-orange"
                  [checked]="discountCode.enabled"
                  (change)="handleEnable(discountCode, $event.checked)"
                >
                </mat-slide-toggle>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="row pt-4 pb-4 pr-4">
        <div class="col-10"></div>
        <div class="col-2 text-right">
          <span class="pagined"
            ><i
              class="fa fa-chevron-left text-light"
              (click)="previousPage()"
              *ngIf="page !== 1"
              style="cursor: pointer"
            ></i>
            {{ page }}/{{ totalPages }}
            <i
              class="fa fa-chevron-right text-light"
              (click)="nextPage()"
              *ngIf="page !== totalPages && totalPages > 0"
              style="cursor: pointer"
            ></i
          ></span>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #code let-modal>
  <div
    class="modal-body text-center"
    style="height: 500px; width: 500px; background-color: #141414"
  >
    <form (ngSubmit)="onSubmit()" [formGroup]="form">
      <div class="row mt-4 justify-content-center">
        <p class="text-center title-modal">Nuevo Código de Descuento</p>
      </div>
      <div class="row mt-4 justify-content-center w-100">
        <div class="col-md-10">
          <div class="form-group">
            <input
              type="text"
              class="form-control"
              placeholder="Código"
              formControlName="code"
            />
          </div>
        </div>
      </div>

      <div class="row mt-2 justify-content-center align-items-center w-100">
        <div class="col-md-6">
          <div class="form-group">
            <input
              type="number"
              class="form-control"
              placeholder="Cantidad"
              formControlName="total"
              [readonly]="infinite"
            />
          </div>
        </div>
        <div class="col-md-3">
          <mat-slide-toggle
            color="mat-orange"
            (change)="handleInfinite($event.checked)"
          ></mat-slide-toggle>
        </div>
        <div class="col-md-1">
          <span
            style="font-family: 'Montserrat'; color: rgba(235, 235, 245, 0.6)"
            class="ml-2"
            >Infinito</span
          >
        </div>
      </div>

      <div class="row mt-2 mb-2 justify-content-center w-100">
        <div class="col-md-10">
          <mat-select [(value)]="type" class="country-select mb-2">
            <mat-option value="" disabled>Tipo</mat-option>
            <mat-option value="percentage">Porcentaje</mat-option>
            <mat-option value="cash">Pesos</mat-option>
          </mat-select>
        </div>
      </div>

      <div class="row mt-2 mb-2 justify-content-center w-100">
        <div class="col-md-10">
          <mat-select [(value)]="selectedCountry" class="country-select mb-2">
            <mat-option value="" disabled>País</mat-option>
            <mat-option
              *ngFor="let country of countries"
              [value]="country.id"
              >{{ country.name }}</mat-option
            >
          </mat-select>
        </div>
      </div>

      <div class="row mt-2 justify-content-center w-100">
        <div class="col-md-10">
          <div class="form-group">
            <input
              type="number"
              class="form-control"
              placeholder="Valor"
              formControlName="value"
            />
          </div>
        </div>
      </div>

      <div class="row mt-2 justify-content-center w-100">
        <div class="col-md-10">
          <button
            class="btn btn-primary btn-block btn-save"
            type="submit"
            [disabled]="!form.valid || !selectedCountry || !type"
          >
            Agregar
          </button>
        </div>
      </div>
    </form>
  </div>
</ng-template>
